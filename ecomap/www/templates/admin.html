<link rel="stylesheet" href="/css/admin.css">

<toaster-container></toaster-container>


<div class="container" >
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <a href="/#/user_profile" class="return-profile">Повернутись до профілю</a>
      <div class="clear"></div>
      <h3>Адміністрування</h3>
      <hr>
      <uib-tabset justified="true">

        <uib-tab heading="Ресурси">
          <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
            <table class="table table-hover">
              <thead>
                <tr>
                  <td>
                    Назва ресурсу
                  </td>
                  <td>
                    Редагування
                  </td>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(resource_name,resource_id) in Resources">
                  <td ng-click="showResPerm(resource_id)">{{resource_name}}</td>
                  <td>
                    <a href="" ng-click="showEditResModal(resource_name,resource_id)">редагувати</a> &nbsp; &nbsp;
                    <a href="" class="del" ng-click="deleteResource(resource_id)">видалити</a>
                  </td>
                </tr>
                
              </tbody>
            </table>
            <button class="btn btn-primary" ng-click="triggerAddResModal()">Додати ресурс</button>
            <div class="clear"></div>
          </div>
        </uib-tab>

        <uib-tab heading="Права">

          <table class="table table-hover">
              <thead>
               <tr>
                 <td>Назва ресурсу</td>
                 <td>Метод</td>
                 <td>Модифікатор доступу</td>
                 <td>Опис права</td>
                 <td>Редагування</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="permision in Permisions">
                 <td >{{permision.resource_name}}</td>
                 <td>{{permision.action}}</td>
                 <td>{{permision.modifier}}</td>
                 <td>{{permision.description}}</td> 
                 <td>
                  <a href="" ng-click="showEditPermModal(permision)">редагувати</a> &nbsp; &nbsp;
                  <a href="" class="del" ng-click="deletePerm(permision)">видалити</a>
                 </td>
               </tr>
             
              </tbody>
            </table>
            <button class="btn btn-primary" ng-click="showAddPermModal()">Додати право</button>
            <div class="clear"></div>
        </uib-tab>

        <uib-tab heading="Ролі">
        <div class="container" >
          <div class="row" ng-show="rolePermTable">
            <div class="col-md-9 col-md-offset-1">
             <table class="table table-stripped" >
              <thead>
               <tr>
                 <td>Назва ролі</td>
                 <td>Редагування</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(role_name,role_id) in Roles">
                  <td >{{role_name}}</td>

                 <td>
                   <a href="" ng-click="showEditRoleModal(role_name,role_id)">редагувати</a>&nbsp; &nbsp;
                  <a href="" class="del" ng-click="deleteRole(role_id)">видалити</a>&nbsp; &nbsp;
                  <a href="" class="del" ng-click="showRolePerm(role_name,role_id)">права ролі</a>
                 </td>
               </tr>
          
              </tbody>
             </table>
             <button class="btn btn-primary" ng-click=" showAddRoleModal()">Додати роль</button>
          </div>
          </div>
          <div class="row" ng-show="rolePermBlock">

             <div class="col-md-6">
             <!-- Actual permision -->
              <form >
              <h4>Актуальні права для {{rolePermObj.name}}</h4>
              <table class="table table-stripped">
              <thead>
               <tr>
                 <td>Назва методу</td>
                 <td>Модифікатор доступу</td>
                 <td>Id</td>
                 <td>Опис</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="perm in actualPermInRole" >
                  <td>{{perm.action}}</td>
                  <td>{{perm.modifier}}</td>
                  <td>{{perm.id || perm.permission_id}}</td>
                  <td>{{perm.descriprion}}</td>
                  <td><button class="btn btn-danger"  ng-click="deletePermFormRole(perm)">Видалити</button></td>
               </tr>
              </tbody>
            </table>
            </table>
 </form>
            </div>
             <div class="col-md-6">
               <!-- All permis -->
                <form ng-submit="bindResPerm()" name="rolePerm" novalidate >
                <h3>Права для додавання для {{rolePermObj.name}}</h3>
                <input type="text" ng-model="searchWord" class="form-control">
                <table class="table table-stripped" id="tablePermRole">

                <thead>
                <tr>
                <td></td>
                 <td>Назва методу</td>
                 <td>Id</td>
                 <td>Ресурс</td>
                 <td>Modifier</td>
                 <td>Опис</td>
                </tr>
                </thead>
               <tbody>
                <tr ng-repeat="perm in Permisions |filter: searchWord " ng-click="selectPerm($event,perm)" ng-class="selectPermObj.hasOwnProperty(perm.permission_id) ? 'selected' : ''" ng-show="checkInActual(perm.permission_id)">
                  <td> <input type="checkbox" ng-checked="isChecked(perm)"></td>
                  <td ng-repeat="perm_prop in perm" > {{perm_prop}}</td>
               </tr>
          
              </tbody>
            </table>
          <button type="submit" class="btn btn-primary">Підтвердити</button>
</form>
             </div>
          </div>
        </div>


        </uib-tab>
        <uib-tab heading="Користувачі" ng-click="loadPagination()">
        <h3>Таблиця користувачів</h3>
        <table class="table table-stripped">
        <thead>
               <tr>
                 <td>Ім’я</td>
                 <td>Прізвище</td>
                 <td>e-mail</td>
                 <td>Id</td>
                 <td>Роль</td>
                 <td>
                 <select ng-model="selectCount.selected" class="form-control" data-ng-options="select_count as select_count for (select_id,select_count) in selectCountObj"></select>


                 </td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="user in selectedUsers">
                <td>{{user.first_name}}</td>
                <td>{{user.last_name}}</td>
                <td>{{user.email}}</td>
                <td>{{user.id}}</td>
                  <td>
                    <select ng-model="user.role_name" class="form-control" data-ng-options="role_ob as role_ob for (role_id,role_ob) in role_obj"></select>
                  </td>
                  <td>
                    <button class="btn btn-primary" ng-click="changeRole(user)">Змінити роль</button>
                  </td>
               </tr>

              </tbody>
        </table>
    <dsiv class="row">
      <div class="col-md-8 col-md-offset-4">
        <uib-pagination ng-change="change(bigCurrentPage)" total-items="bigTotalItems" ng-model="bigCurrentPage" max-size="maxSize" class="pagination" boundary-links="true"></uib-pagination >
        </div>
      </div>
        </uib-tab>

      </uib-tabset>
    </div>
  </div>
</div>



<modal title="Додати ресурс" visible="addResModal">
  <form  ng-submit="addResource()" name="addResForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addResForm.resName.$touched && addResForm.resName.$invalid }">
      <label for="" class="control-label" >Назва ресурса</label>
      <input type="text" class="form-control" name="resName" ng-model="newResource.name" ng-maxlength="255" required>

    </div>
    <div class="help-block" ng-messages="addResForm.resName.$error" ng-show="addResForm.resName.$touched">
      <p ng-message="maxlength">Занадто довге імя ресурсу!</p>
      <p ng-message="required">Необхідно ввести нове імя ресурсу!</p>
      <!-- custom error: name already exists -->
    </div>
    <button type="submit" class="btn btn-primary">Додати</button>
  </form>
</modal>

<!-- Modal window for editing resource -->
<modal title="Редагувати ресурс" visible="editResModal">
  <form  ng-submit="editResource()" name="editResForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': editResForm.resName.$touched && editResForm.resName.$invalid }">
      <label for="" class="control-label" >Назва ресурса</label>
      <input type="text" class="form-control" name="resName" ng-model="editResObj.name" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="editResForm.resName.$error" ng-show="editResForm.resName.$touched">
      <p ng-message="maxlength">Занадто довге імя ресурсу!</p>
      <p ng-message="required">Необхідно ввести нове імя ресурсу!</p>
      <!-- custom error: name already exists -->
    </div>
    <button type="button" ng-click="editResource()" class="btn btn-primary">Змінити</button>
  </form>
</modal>

<!-- Modal window for adding permissions

<td>{{permision.resource_name}}</td>
                 <td>{{permision.action}}</td>
                 <td>{{permision.modifier}}</td>
                 <td>{{permision.description}}</td>


-->
<modal title="Додати право" visible="addPermModal">
  <form  ng-submit="addPermSubmit()" name="addPerm" novalidate>
    <div class="form-group">
      <label for="" class="control-label" >Назва ресурса</label>
      <select ng-model="perm.resource_name" class="form-control" data-ng-options="resource_name as resource_name for (resource_name,resource_id) in Resources"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Метод</label>
      <select ng-model="perm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Модифікатор доступу</label>
      <select ng-model="perm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
    </div>
    <div class="form-group" ng-class="{ 'has-error': addPerm.descr.$touched && addPerm.descr.$invalid }">
      <label for="" class="control-label" >Опис права</label>
      <input type="text" class="form-control" name="descr" ng-model="perm.description" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="addPerm.descr.$error" ng-show="addPerm.descr.$touched">
      <p ng-message="maxlength">Занадто довгий опис!</p>
      <p ng-message="required">Необхідно ввести опис!</p>
    </div>
    <button type="sumbit" class="btn btn-primary">Додати право</button>
  </form>
</modal>

<!-- Modal window for editing permissions -->
<modal title="Редагувати право" visible="editPermModal">
  <form  ng-submit="editPermSubmit()" name="editPermition" novalidate>
    <div class="form-group">
      <label for="" class="control-label" >Назва ресурса</label>
      <select ng-model="editPerm.resource_name" class="form-control" data-ng-options="resource_name as resource_name for (resource_name,resource_id) in Resources"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Метод</label>
      <select ng-model="editPerm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Модифікатор доступу</label>
      <select ng-model="editPerm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
    </div>
    <div class="form-group" ng-class="{ 'has-error': editPerm.descr.$touched && editPerm.descr.$invalid }">
      <label for="" class="control-label" >Опис права</label>
      <input type="text" class="form-control" name="descr" ng-model="editPerm.description" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="editPerm.descr.$error" ng-show="editPerm.descr.$touched">
      <p ng-message="maxlength">Занадто довгий опис!</p>
      <p ng-message="required">Необхідно ввести опис!</p>
    </div>
    <button type="submit" class="btn btn-primary">Змінити право</button>
  </form>
</modal>

<!-- Modal window for creating roles -->
<modal title="Додати роль" visible="addRoleModal">
  <form  ng-submit="addRoleSubmit()" name="addRoleForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
      <label for="" class="control-label" >Назва ролі</label>
      <input type="text" class="form-control" name="roleName" ng-model="role.name" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="addRoleForm.roleName.$error" ng-show="addRoleForm.roleName.$touched">
      <p ng-message="maxlength">Занадто довге імя ролі!</p>
      <p ng-message="required">Необхідно ввести нове імя ролі!</p>
      <!-- custom error: name already exists -->
    </div>

    <button type="submit" class="btn btn-primary">Додати</button>
  </form>
</modal>

<modal title="Редагувати роль" visible="editRoleModal">
  <form  ng-submit="editRole()" name="editRoleForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
      <label for="" class="control-label" >Назва ролі</label>
      <input type="text" class="form-control" name="roleName" ng-model="editRoleObj['name']" ng-maxlength="255" required>
    </div>
    
    <button type="submit" class="btn btn-primary">Змінити</button>
  </form>
</modal>







<modal title="Error" visible="customEror" id="customEror">
  <div class="row" >
    <div class="col-md-6 ">
      {{Eror}}
    </div>
  </div>
</modal>

