<link rel="stylesheet" href="/css/admin.css">


<div ui-view name="resource"></div>
<div class="container" >
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <a href="/#/user_profile" class="return-profile">Повернутись до профілю</a>
      <div class="clear"></div>
      <h3>Адміністрування</h3>
      <hr>
      <uib-tabset justified="true">

        <uib-tab heading="Ресурси" href="resource">   
           <div class="row" ng-controller="ResourceCtrl">
            <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8 col-md-offset-2">
            <table class="table table-hover">
              <thead>
                <tr>
                  <td>
                    Назва ресурсу
                  </td>
                  <td><button class="btn btn-primary btn-border" ng-click="triggerAddResModal()">
                  <i class="fa fa-plus "></i>&nbsp;&nbsp;додати ресурс</button></td>
                 
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(resource_name,resource_id) in Resources">
                  <td >{{resource_name}}</td>
                  <td>
                  <button class="btn btn-primary edit_btn btn-border" ng-click="showeditResModal(resource_name,resource_id)">редагувати</button>
                  <button class="btn btn-danger edit_btn btn-border" ng-click="deleteResource(resource_id)">видалити</button>
                  </td>
                </tr>
                
              </tbody>
            </table>
            
          </div>
          <modal title="Додати ресурс" visible="addResModal">
            <form  ng-submit="addResource(newResource)" name="addResForm" novalidate>
              <div class="row">
              <div class="col-md-12 ">
              <div class="form-group" ng-class="{ 'has-error': (addResForm.resName.$touched || addResSub) && addResForm.resName.$invalid }">
                <label for="" class="control-label" >Назва ресурса</label>
                <div class="row">
                  <div class="col-md-11">
                  <input type="text" class="form-control" name="resName" ng-model="newResource.name" ng-maxlength="255" required>
                 </div>
                <div class="col-md-1"><button type="submit" class="btn btn-primary btn-border" ng-click="addResSub=true">додати</button></div>
                </div>

                <div class="help-block" ng-messages="addResForm.resName.$error" ng-show="addResForm.resName.$touched || addResSub">
                <div ng-messages-include="/templates/error_msgs.html"></div>
                </div>

              </div>
            </div>
            </div>
           </form>
        </modal>
        <modal title="Редагувати ресурс" visible="editResModal">
          <form  ng-submit="editResource(editResObj)" name="editResForm" novalidate>
            <div class="form-group" ng-class="{ 'has-error': (editResForm.resName.$touched || editResSub) && editResForm.resName.$invalid }">
              <div class="row">
                <div class="col-md-12"><label for="" class="control-label" >Назва ресурса</label></div>
                <div class="col-md-11"><input type="text" class="form-control" name="resName" ng-model="editResObj.name" ng-maxlength="255" required></div>
                <div class="col-md-1"><button type="submit" class="btn btn-primary btn-border" ng-click="editResSub=true">змінити</button></div>
              </div>
            
              <div class="help-block" ng-messages="editResForm.resName.$error" ng-show="editResForm.resName.$touched || editResSub">
                <div ng-messages-include="/templates/error_msgs.html"></div>

              </div>
            </div>
          </form>
        </modal>
          </div>       
        </uib-tab>

        <uib-tab heading="Права">

          <div class="row" ng-controller="PermisionCtrl">

            <div class="col-md-12">
              <table class="table table-hover" >
              <thead>
               <tr>
                 <td>Назва ресурсу</td>
                 <td>Метод</td>
                 <td>Модифікатор доступу</td>
                 <td>Опис права</td>
                 <td>  <button class="btn btn-primary btn-border" ng-click="showAddPermModal()"> <i class="fa fa-plus "></i>&nbsp;&nbsp;додати право</button></td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="permision in Permisions">
                 <td >{{permision.resource_name}}</td>
                 <td>{{permision.action}}</td>
                 <td>{{permision.modifier}}</td>
                 <td>{{permision.description}}</td> 
                 <td>
                  <button class="btn btn-primary edit_btn btn-border" ng-click="showEditPermModal(permision)">редагувати</button>
                  <button class="btn btn-danger edit_btn btn-border" ng-click="deletePerm(permision)">видалити</button>
                 </td>
               </tr>
             
              </tbody>
            </table>
            </div>
            <modal title="Додати право" visible="addPermModal">
                <form  ng-submit="addPermSubmit()" name="addPerm" novalidate>
                  <div class="form-group">
                    <label for="" class="control-label" >Назва ресурса : </label >

                    <select ng-model="perm.resource_name" class="form-control" data-ng-options="resource_name as resource_name for (resource_name,resource_id) in Resources"></select>
                  </div>
                  <div class="form-group">
                    <label class="control-label">Метод</label>
                    <select ng-model="perm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
                  </div>
                  <div class="form-group">
                    <label class="control-label">Модифікатор доступу</label>
                    <select ng-model="perm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
                  </div>

                  <div class="form-group" ng-class="{ 'has-error': addPerm.descr.$touched && addPerm.descr.$invalid }">
                     <div class="row">
                   <div class="col-md-12"><label for="" class="control-label" >Опис права</label></div>
                    <div class="col-md-11"> <input type="text" class="form-control" name="descr" ng-model="perm.description" ng-maxlength="255" required></div>
                    <div class="col-md-1"><button type="sumbit" class="btn btn-primary btn-border">додати</button></div>
                  </div>     
                  </div>
                  <div class="help-block" ng-messages="addPerm.descr.$error" ng-show="addPerm.descr.$touched">
                    <div ng-messages-include="/templates/error_msgs.html"></div>
                  </div>

                </form>
              </modal>

              <modal title="Редагувати право" visible="editPermModal">
                <form  ng-submit="editPermSubmit()" name="editPermition" novalidate>
                  <div class="form-group">
                    <label> Назва ресурсу :</label>
                    <div class="well well-sm"> {{editPerm.resource_name}}</div>
                    
                  </div>
                  <div class="form-group">
                    <label class="control-label">Метод</label>
                    <select ng-model="editPerm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
                  </div>
                  <div class="form-group">
                    <label class="control-label">Модифікатор доступу</label>
                    <select ng-model="editPerm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
                  </div>
                  <div class="form-group" ng-class="{ 'has-error': editPerm.descr.$touched && editPerm.descr.$invalid }">
                  <div class="row">
                   <div class="col-md-12"><label for="" class="control-label" >Опис права</label></div>
                    <div class="col-md-11"><input type="text" class="form-control" name="descr" ng-model="editPerm.description" ng-maxlength="255" required></div>
                    <div class="col-md-1"><button type="submit" class="btn btn-primary btn-border">змінити</button></div>
                  </div>
                   
                    
                  </div>

                  <div class="help-block" ng-messages="editPerm.descr.$error" ng-show="editPerm.descr.$touched">
                    <div ng-messages-include="/templates/error_msgs.html"></div>
                  </div>
                  
                </form>
              </modal>
          </div>

        </uib-tab>

      <uib-tab heading="Ролі">
        <div class="container" ng-controller="RoleCtrl">
        <modal title="Додати роль" visible="addRoleModal">
          <form  ng-submit="addRoleSubmit()" name="addRoleForm" novalidate>
            <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
            <div class="row">
              <div class="col-md-12"><label for="" class="control-label" >Назва ролі</label></div>
              <div class="col-md-11"> <input type="text" class="form-control" name="roleName" ng-model="role.name" ng-maxlength="255" required></div>
              <div class="col-md-1"><button type="submit" class="btn btn-primary btn-border">додати</button></div>
            </div>
            
            </div>
            <div class="help-block" ng-messages="addRoleForm.roleName.$error" ng-show="addRoleForm.roleName.$touched">
              <div ng-messages-include="/templates/error_msgs.html"></div>
            </div>


          </form>
        </modal>

        <modal title="Редагувати роль" visible="editRoleModal">
          <form  ng-submit="editRole()" name="editRoleForm" novalidate>
            <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
            <div class="row">
              <div class="col-md-12"><label for="" class="control-label" >Назва ролі</label></div>
              <div class="col-md-11"><input type="text" class="form-control" name="roleName" ng-model="editRoleObj['name']" ng-maxlength="255" required></div>
              <div class="col-md-1"> <button type="submit" class="btn btn-primary btn-border">Змінити</button></div>
            </div>
              
              
            </div>    

          </form>
        </modal>

          <div class="row" ng-show="rolePermTable">
            <div class="col-md-9 col-md-offset-1">
             <table class="table table-stripped" >
              <thead>
               <tr>
                 <td>Назва ролі</td>
                 <td><button class="btn btn-primary btn-border" ng-click=" showAddRoleModal()"> <i class="fa fa-plus "></i>&nbsp;&nbsp;додати роль</button></td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(role_name,role_id) in Roles">
                  <td >{{role_name}}</td>

                 <td>
                 <button class="btn btn-danger edit_btn btn-border" ng-click="deleteRole(role_id)">видалити</button>
                 
                 <button class="btn btn-warning edit_btn btn-border" ng-click="showEditRoleModal(role_name,role_id)">редагувати</button>
                 <button class="btn btn-primary edit_btn btn-border" ng-click="showRolePerm(role_name,role_id)">права ролі</button>
                 
                 </td>
               </tr>
          
              </tbody>
             </table>
             
          </div>
          </div>
          <br>
          <br>
          
          <div class="row" ng-show="rolePermBlock">
            <div class="row">
            <div class="col-md-8">
              <div class="well well-sm">Роль : {{rolePermObj.name}}</div>
              </div>
            <div class="col-md-3">
              <button class="btn btn-primary btn-border" ng-click="backToRole()"><i class="fa fa-arrow-left"></i>&nbsp;&nbsp; повернутись до ролей</button>
            </div>
          </div>
             <div class="col-md-6">
             
             <div class="row">

             <div class="col-md-12">
              <form>
              <h3>Актуальні права</h3>
              <input type="text" ng-model="searchWordActua" class="form-control">
              <table class="table table-stripped"  >
              <thead>
               <tr>
                 <td>Назва методу</td>
                 <td>Модифікатор доступу</td>
                 <td>Id</td>
                 <td>Опис</td>
                
               </tr>
              </thead>
              <tbody ng-if="listToSend.length !== 0">
                <tr ng-repeat="perm in actualPermInRole | filter : searchWordActua" >
                  <td>{{perm.action}}</td>
                  <td>{{perm.modifier}}</td>
                  <td>{{perm.id || perm.permission_id}}</td>
                  <td>{{perm.description}}</td>
                  <td><button class="btn btn-danger btn-border"  ng-click="deletePermFormRole(perm)">Видалити</button></td>
               </tr>
              </tbody>
            </table>
            </form>
               </div>
             </div>  


            </div>
             <div class="col-md-6">
               <!-- All permis -->
               <div class="row">
                <div class="col-md-12">
                <form ng-submit="bindResPerm()" name="rolePerm" novalidate >
                <h3>Права для додавання </h3>
                <input type="text" ng-model="searchWord" class="form-control">
                <table class="table table-stripped" id="tablePermRole">

                <thead>
                <tr>
                <td></td>
                 <td>Назва методу</td>
                 <td>Id</td>
                 <td>Ресурс</td>
                 <td>Modifier</td>
                 <td>Опис</td>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="perm in Permisions |filter: searchWord " ng-click="selectPerm($event,perm)" ng-show="checkInActual(perm.permission_id)">
                  <td> <input type="checkbox" ng-checked="isChecked(perm)"></td>
                  <td ng-repeat="perm_prop in perm" > {{perm_prop}}</td>
                </tr>
          
                </tbody>
                </table>
                  <button type="submit" class="btn btn-primary btn-border">Підтвердити</button>
                </form>
                 </div>
               </div>
             </div>
          </div>
        </div>


        </uib-tab>
      <uib-tab heading="Користувачі" ng-click="loadPagination()" >

        <h3>Таблиця користувачів</h3>
        <div class="row" ng-controller="UserCtrl">
          <div class="col-md-12">

            <table class="table table-stripped">
        <thead>
               <tr>
                 <td>Ім’я</td>
                 <td>Прізвище</td>
                 <td>e-mail</td>
                 <td>Id</td>
                 <td>Роль</td>
                 <td>
                 <select ng-model="selectCount.selected" class="form-control" data-ng-options="select_count as select_count for (select_id,select_count) in selectCountObj" ng-change="loadPagination()"></select>


                 </td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="user in selectedUsers">
                <td>{{user.first_name}}</td>
                <td>{{user.last_name}}</td>
                <td>{{user.email}}</td>
                <td>{{user.id}}</td>
                  <td>
                    <select ng-model="user.role_name" class="form-control" data-ng-options="role_ob as role_ob for (role_ob,role_id) in Roles"></select>
                  </td>
                  <td>
                    <button class="btn btn-primary btn-border" ng-click="changeRole(user)">Змінити роль</button>
                  </td>
               </tr>

              </tbody>
        </table>
        <div class="row">
        <div class="col-md-8 col-md-offset-4">
        <uib-pagination ng-change="change(bigCurrentPage)" total-items="bigTotalItems" ng-model="bigCurrentPage" max-size="maxSize" class="pagination" boundary-links="true"></uib-pagination >
        </div>
      </div>
          </div>
        </div>
        
        </uib-tab>

      </uib-tabset>
    </div>
  </div>
</div>
