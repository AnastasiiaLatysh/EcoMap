<link rel="stylesheet" href="/css/admin.css">

<toaster-container></toaster-container>

<div class="container" >
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <a href="/#/user_profile" class="return-profile">Повернутись до профілю</a>
      <div class="clear"></div>
      <h3>Адміністрування</h3>
      <hr>
      <uib-tabset justified="true">

        <uib-tab heading="Ресурси">
          <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
            <table class="table table-hover">
              <thead>
                <tr>
                  <td>
                    Назва ресурсу
                  </td>
                  <td>
                    Редагування
                  </td>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(resource_name,resource_id) in Resources">
                  <td ng-click="showResPerm(resource_id)">{{resource_name}}</td>
                  <td>
                    <a href="" ng-click="showEditResModal(resource_name,resource_id)">редагувати</a> &nbsp; &nbsp;
                    <a href="" class="del" ng-click="deleteResource(resource_id)">видалити</a>
                  </td>
                </tr>
                
              </tbody>
            </table>
            <button class="btn btn-primary" ng-click="triggerAddResModal()">Додати ресурс</button>
            <div class="clear"></div>
          </div>
        </uib-tab>

        <uib-tab heading="Права">

          <table class="table table-hover">
              <thead>
               <tr>
                 <td>Назва ресурсу</td>
                 <td>Метод</td>
                 <td>Модифікатор доступу</td>
                 <td>Опис права</td>
                 <td>Редагування</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="permision in Permisions">
                 <td >{{permision.resource_name}}</td>
                 <td>{{permision.action}}</td>
                 <td>{{permision.modifier}}</td>
                 <td>{{permision.description}}</td> 
                 <td>
                  <a href="" ng-click="showEditPermModal(permision)">редагувати</a> &nbsp; &nbsp;
                  <a href="" class="del" ng-click="deletePerm(permision)">видалити</a>
                 </td>
               </tr>
             
              </tbody>
            </table>
            <button class="btn btn-primary" ng-click="showAddPermModal()">Додати право</button>
            <div class="clear"></div>
        </uib-tab>

        <uib-tab heading="Ролі">
          <table class="table table-stripped">
              <thead>
               <tr>
                 <td>Назва ролі</td>
                 <td>Редагування</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(role_name,role_id) in Roles">
                  <td >{{role_name}}</td>
                 </td>
                 <td>
                   <a href="" ng-click="showEditRoleModal(role_name,role_id)">редагувати</a>&nbsp; &nbsp;
                  <a href="" class="del" ng-click="deleteRole(role_id)">видалити</a>&nbsp; &nbsp;
                  <a href="" class="del" ng-click="showRolePerm(role_name,role_id)">права ролі</a>
                 </td>
               </tr>
          
              </tbody>
            </table>
            <button class="btn btn-primary" ng-click=" showAddRoleModal()">Додати роль</button>
            <div class="clear"></div>
        </uib-tab>
      </uib-tabset>
    </div>
  </div>
</div>

<!-- Modal window for resource creating -->
<modal title="Права ролі" visible="rolePerm">

<form ng-submit="bindResPerm()" name="rolePerm" novalidate>
<div class="container">

  
</div>
<h3>Вже прив’язані події</h3>  
  <table class="table table-stripped">
  <thead>
               <tr>
                 <td>Назва методу</td>
                 <td>Modifier</td>
                 <td>Id</td>
                 <td>Опис</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="perm in actualPermInRole" >
                
                  <td ng-repeat="perm_prop in perm">{{perm_prop}}</td>
                  <td><button class="btn-danger"  ng-click="deletePermFormRole(perm)">DELETE</button></td>
                
               </tr>
          
              </tbody>
            </table>
  </table>
  <h3>Виберіть події для прив’язки</h3> 
   <input type="text" ng-model="searchWord" class="form-control">
  <table class="table table-stripped" id="tablePermRole">

              <thead>
               <tr>
                 <td>Назва методу</td>
                 <td>Id</td>
                 <td>Ресурс</td>
                 <td>Modifier</td>
                 <td>Опис</td>
               </tr>
              </thead>
              <tbody>
                <tr ng-repeat="perm in Permisions |filter: searchWord " ng-click="selectPerm($event,perm)" ng-class="selectPermObj.hasOwnProperty(perm.permission_id) ? 'selected' : ''" ng-show="checkInActual(perm.permission_id)">
                  
                  <td ng-repeat="perm_prop in perm" >{{perm_prop}}</td>
                  
               </tr>
          
              </tbody>
            </table>
          <button type="submit" class="btn btn-primary">Додати</button>
</form>
</modal>


<modal title="Додати ресурс" visible="addResModal">
  <form  ng-submit="addResource()" name="addResForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addResForm.resName.$touched && addResForm.resName.$invalid }">
      <label for="" class="control-label" >Назва ресурса</label>
      <input type="text" class="form-control" name="new_res" ng-model="newResource.name" ng-maxlength="255" required>

    </div>
    <div class="help-block" ng-messages="addResForm.resName.$error" ng-show="addResForm.resName.$touched">
      <p ng-message="maxlength">Занадто довге імя ресурсу!</p>
      <p ng-message="required">Необхідно ввести нове імя ресурсу!</p>
      <!-- custom error: name already exists -->
    </div>
    <button type="submit" class="btn btn-primary">Додати</button>
  </form>
</modal>

<!-- Modal window for editing resource -->
<modal title="Редагувати ресурс" visible="editResModal">
  <form action="" ng-submit="editResource()" name="editResForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': editResForm.resName.$touched && editResForm.resName.$invalid }">
      <label for="" class="control-label" >Назва ресурса</label>
      <input type="text" class="form-control" name="resName" ng-model="editResObj.name" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="editResForm.resName.$error" ng-show="editResForm.resName.$touched">
      <p ng-message="maxlength">Занадто довге імя ресурсу!</p>
      <p ng-message="required">Необхідно ввести нове імя ресурсу!</p>
      <!-- custom error: name already exists -->
    </div>
    <button type="submit" class="btn btn-primary">Змінити</button>
  </form>
</modal>

<!-- Modal window for adding permissions 
<td>{{permision.resource_name}}</td>
                 <td>{{permision.action}}</td>
                 <td>{{permision.modifier}}</td>
                 <td>{{permision.description}}</td>
-->
<modal title="Додати право" visible="addPermModal">
  <form action="" ng-submit="addPermSubmit()" name="addPerm" novalidate>
    <div class="form-group">
      <label for="" class="control-label" >Назва ресурса</label>
      <select ng-model="perm.resource_name" class="form-control" data-ng-options="resource_name as resource_name for (resource_name,resource_id) in Resources"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Метод</label>
      <select ng-model="perm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Модифікатор доступу</label>
      <select ng-model="perm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
    </div>
    <div class="form-group" ng-class="{ 'has-error': addPerm.descr.$touched && addPerm.descr.$invalid }">
      <label for="" class="control-label" >Опис права</label>
      <input type="text" class="form-control" name="descr" ng-model="perm.description" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="addPerm.descr.$error" ng-show="addPerm.descr.$touched">
      <p ng-message="maxlength">Занадто довгий опис!</p>
      <p ng-message="required">Необхідно ввести опис!</p>
    </div>
    <button type="sumbit" class="btn btn-primary">Додати право</button>
  </form>
</modal>

<!-- Modal window for editing permissions -->
<modal title="Редагувати право" visible="editPermModal">
  <form action="" ng-submit="editPermSubmit()" name="editPermition" novalidate>
    <div class="form-group">
      <label for="" class="control-label" >Назва ресурса</label>
      <select ng-model="editPerm.resource_name" class="form-control" data-ng-options="resource_name as resource_name for (resource_name,resource_id) in Resources"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Метод</label>
      <select ng-model="editPerm.action" class="form-control" data-ng-options="meth as meth for meth in meth_obj"></select>
    </div>
    <div class="form-group">
      <label class="control-label">Модифікатор доступу</label>
      <select ng-model="editPerm.modifier" class="form-control" data-ng-options="modif as modif for modif in modif_obj"></select>
    </div>
    <div class="form-group" ng-class="{ 'has-error': editPerm.descr.$touched && editPerm.descr.$invalid }">
      <label for="" class="control-label" >Опис права</label>
      <input type="text" class="form-control" name="descr" ng-model="editPerm.description" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="editPerm.descr.$error" ng-show="editPerm.descr.$touched">
      <p ng-message="maxlength">Занадто довгий опис!</p>
      <p ng-message="required">Необхідно ввести опис!</p>
    </div>
    <button type="submit" class="btn btn-primary">Змінити право</button>
  </form>
</modal>

<!-- Modal window for creating roles -->
<modal title="Додати роль" visible="addRoleModal">
  <form action="" ng-submit="addRoleSubmit()" name="addRoleForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
      <label for="" class="control-label" >Назва ролі</label>
      <input type="text" class="form-control" name="roleName" ng-model="role.name" ng-maxlength="255" required>
    </div>
    <div class="help-block" ng-messages="addRoleForm.roleName.$error" ng-show="addRoleForm.roleName.$touched">
      <p ng-message="maxlength">Занадто довге імя ролі!</p>
      <p ng-message="required">Необхідно ввести нове імя ролі!</p>
      <!-- custom error: name already exists -->
    </div>
    <div class="form-group">
      <label class="control-label">Права ролі:</label>
    </div>
    <button type="submit" class="btn btn-primary">Додати</button>
  </form>
</modal>

<modal title="Редагувати роль" visible="editRoleModal">
  <form action="" ng-submit="editRole()" name="editRoleForm" novalidate>
    <div class="form-group" ng-class="{ 'has-error': addRoleForm.roleName.$touched && addRoleForm.roleName.$invalid }">
      <label for="" class="control-label" >Назва ролі</label>
      <input type="text" class="form-control" name="roleName" ng-model="editRoleObj.name" ng-maxlength="255" required>
    </div>
    
    <button type="submit" class="btn btn-primary">Змінити</button>
  </form>
</modal>







<modal title="Error" visible="customEror" id="customEror">
  <div class="row" >
    <div class="col-md-6 ">
      {{Eror}}
    </div>
  </div>
</modal>