<div ng-controller="UserProblemTableCtrl">
  <div class="row">
    <h3 class="col-md-10 title">Коментарі {{user.data.surname}} {{user.data.name}}</h3>
    <div class="col-md-1 col-sm-2">
      <div class="select">
        <select ng-model="selectCount.selected" 
                class="form-control" 
                data-ng-options="select_count as select_count for (select_id,select_count) in selectCountObj" 
                ng-change="loadProblems()">
        </select>
      </div>
    </div>
  </div>
  <hr class="problems">
  <table class="table table-stripped UserProblemTable">
    <thead>
      <tr>
        <td ng-click="sortType = 'nickname'; sortReverse = !sortReverse"><strong>Псевдонім</strong>
          <span ng-show="sortType == 'nickname' && !sortReverse" class="fa fa-caret-down">
          </span>
          <span ng-show="sortType == 'nickname' && sortReverse" class="fa fa-caret-up">
          </span>
        </td>
        <td ng-click="sortType = 'date';sortReverse = !sortReverse"><strong>Дата створення</strong>
          <span ng-show="sortType == 'date' && !sortReverse" class="fa fa-caret-down"></span>
          <span ng-show="sortType == 'date' && sortReverse" class="fa fa-caret-up"></span>
        </td>
        <td ng-click="sortType = 'text';sortReverse = !sortReverse"><strong>Текст коментаря</strong>
          <span ng-show="sortType == 'text' && !sortReverse" class="fa fa-caret-down">
          </span>
          <span ng-show="sortType == 'text' && sortReverse" class="fa fa-caret-up">
          </span>
        </td>
        <td><strong ng-click="sortType = 'answer';sortReverse = !sortReverse">Відповіді</strong>
          <span ng-show="sortType == 'answer' && !sortReverse" class="fa fa-caret-down"></span>
          <span ng-show="sortType == 'answer' && sortReverse" class="fa fa-caret-up"></span>
        </td>
        <td><strong>Детальне інфо</strong> 
        </td>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="comment in problems | orderBy:sortType:sortReverse">
        <td>{{comment.nickname}}</td>
        <td>{{problem.date | date : "dd/MM/yyyy "}}</td> 
        <td class="problem-title">{{comment.content}}</td>
        <td><a role="button" ng-click="" ng-show="comment.sub_count">{{comment.sub_count | answerFilter}}</a></td>
        <td><a href="" ng-click="triggerDetailModal(problem.id)">переглянути проблему</a></td>
      </tr>
    </tbody>
  </table>
  <p ng-hide="commentsLength"><strong>Загальна кількість коментарів: </strong>
     <span>{{count}}</span>
  </p>
    <div class="row">
      <div class="col-md-8 col-md-offset-4">
        <uib-pagination ng-change="change(bigCurrentPage)" total-items="bigTotalItems" ng-model="bigCurrentPage" max-size="maxSize" class="pagination" boundary-links="true"></uib-pagination >
      </div>
    </div>
    <modal title="Детальна інформація про проблему" visible="detailedInfoModal" class="det-problem-modal">
      <div class="title">
        <h3 ng-bind="detailedProblem.title"></h3>
      </div>
      <div class="general">
        <div class="row">
          <div class="col-lg-4">
          <div class="rate">
            <uib-rating max="5" ng-model="detailedProblem.severity" readonly="true" state-on="'fa fa-star'" state-off="'fa fa-star-o'"></uib-rating>
          </div>
          </div>
          <div class="col-lg-4">
          <div class="solution unsolved" >
            <strong><span ng-bind="detailedProblem.status" ng-class="{ 'solved': 'detailedProblem.status' == 'solved' }"></span></strong>
          </div>
          </div>
          <div class="col-lg-4">
            <div class='eye_subscription'>
              <span ng-class="cls_eye_subs" ng-click="chgEyeSubsc()"></span>
            </div>
          </div>
        </div>
        <div class="clear"></div>
      </div>
      <uib-tabset justified="true">
      <uib-tab heading="Детально">
        <div class="problem-type">
          <p><strong>Тип проблеми:</strong></p>
          <p ng-model="detailedProblem.problem_type_id">
            {{detailedProblem.name}}
          </p>
        </div>
        <div class="description">
          <p><strong>Опис проблеми:</strong></p>
          <p ng-bind="detailedProblem.content"></p>
        </div>
        <div class="proposal">
          <p><strong>Пропозиції щодо вирішення</strong></p>
          <p ng-bind="detailedProblem.proposal"></p>
        </div>
      </uib-tab>
      <uib-tab heading="Коментарі">
        <div class="row">
          <div class="col-sm-12" ng-repeat='comment in comments'>
            <div class="panel panel-default">
              <div class="panel-heading">
                <strong>{{comment.name}}</strong>
                <span class="text-muted">{{comment.created_date | date : "dd/MM/yyyy HH:mm "}}</span>
              </div>
              <div class="panel-body comment-block">
                {{comment.content}}
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
    </uib-tabset>
  </modal>
</div>
